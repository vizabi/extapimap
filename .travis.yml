language: node_js
dist: trusty
sudo: true
node_js:
- 7.5.0
addons:
  apt:
    packages:
    - python-pip
notifications:
  email: false
  slack:
    rooms:
    - gapminder:siB4Z9ymsYR6qHnRPpgUoB2Q#vizabi-spam
    on_success: change
    on_failure: always
cache:
  directories:
  - node_modules
before_install:
- npm install -g npm@latest
- sudo pip install s3cmd
before_script:
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- npm run build
script:
- npm run deploy
deploy:
  skip_cleanup: true
  provider: npm
  email: kgrpwnz@gmail.com
  api_key:
    secure: TnnZKd//8jkev51Yjp6+PWV5Pc7tLeX11Sqvpk5+7fbwIJNmyVN7/iBfrEeiseBRiexnhFRl1c/dgqj/VZThs+xnxPfuYTYS86Dio+ZFcko91cmrJ9aSkyKUcp7fNIC+ukZXaqudX/+TcH1NG6k6hR5OkwV/ginSUzXSgQewDWbcIMIwcSw8GiyhKPC8GZ+jNUmpOz7CJ/WHtTYqZZ/1Zbs+KXP8V9cqhtSPuLS+OnhQzxRByj75WS9rfkLHTBVKSLU1JLgD/HGYGGMdMfvhO3C9tvwBKZ/tFvxQCyFfeW5w74NXCGuIJwyNzIAIxH9qfKy1htXPeySFxMIyXon/qx3vNyHSA3mS8Hs/00Ec8H9kveqj9pwnLaDbgjf69Ww49Ea3cX4oa1QM0sAcrRl3AXHheHhNsgGE0Ofk6A1pLrbfKfzhs/G1ynxlozyOEdNmCYhc6RYOXSq9b+lW8AUnx7g7/9UufDpU81XYsAdwQh1J+0vduUCkFGO3OntmqDRX2bYQBRmU5H7ngEerAsBlTs+5lHsfix7QmYYYzGZb9iC1FKpEoKaHihKf+6QRQlxZEN03uxjvAeyWU6B4l13uhAJ8u8Z4hOrhH6wT4hSvhWq4GLuyNt6gdeG76UOM1pmU3aC+ofBNJ4j6nlNRfGsFo1bxVVCj58zTP0mx7uQE2yo=
  on:
    branch: develop
    node: 7.5.0
    condition: "-e /tmp/deployment.flag"
